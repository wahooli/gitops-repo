- id: enable_zigbee_join
  alias: Enable Zigbee joining
  trigger:
    platform: state
    entity_id: input_boolean.zigbee_permit_join
    to: 'on'
  action:
  - service: mqtt.publish
    data:
      topic: zigbee2mqtt/bridge/config/permit_join
      payload: 'true'
  - service: timer.start
    data:
      entity_id: timer.zigbee_permit_join
- id: disable_zigbee_join
  alias: Disable Zigbee joining
  trigger:
  - entity_id: input_boolean.zigbee_permit_join
    platform: state
    to: 'off'
  action:
  - data:
      payload: 'false'
      topic: zigbee2mqtt/bridge/config/permit_join
    service: mqtt.publish
  - data:
      entity_id: timer.zigbee_permit_join
    service: timer.cancel
- id: disable_zigbee_join_timer
  alias: Disable Zigbee joining by timer
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.zigbee_permit_join
  action:
  - service: mqtt.publish
    data:
      topic: zigbee2mqtt/bridge/config/permit_join
      payload: 'false'
  - service: input_boolean.turn_off
    data:
      entity_id: input_boolean.zigbee_permit_join
- id: '1589327020759'
  alias: Open Blinds in morning
  description: ''
  trigger:
  - above: 1450
    below: 20000
    device_id: 2baa679abe534298b09d6aa1f026a88c
    domain: sensor
    entity_id: sensor.balcony_sensor_light_level
    for:
      hours: 0
      minutes: 5
      seconds: 0
    platform: device
    type: illuminance
  condition:
  - after: 06:45
    before: 09:30
    condition: time
  action:
  - device_id: 6a463a21fec042a2850f77bdfa724470
    domain: cover
    entity_id: cover.bedroom_small_blinds
    position: 90
    type: set_position
  - device_id: 4ea2572e09b3416893bac59ddc4614d7
    domain: cover
    entity_id: cover.bedroom_big_blinds
    position: 90
    type: set_position
  - device_id: c6c6dde8df734cf9a02f7bf01866bd82
    domain: light
    entity_id: light.nightstand
    type: turn_off
  - device_id: 8ef9c835206748bc8439cbf9dabec7f9
    domain: light
    entity_id: light.desk
    type: turn_off
- id: '1589340326457'
  alias: Turn off the lights when I leave home
  description: ''
  trigger:
  - entity_id: person.waltteri_hooli
    event: leave
    platform: zone
    zone: zone.home
  condition: []
  action:
  - service: light.turn_off
    data: {}
    entity_id: light.bathroom_lights
  - service: light.turn_off
    data: {}
    entity_id: light.hallway_lights
  - service: light.turn_off
    data: {}
    entity_id: light.bedroom_lights
  - service: light.turn_off
    data: {}
    entity_id: light.kitchen_lights
  - service: light.turn_off
    data: {}
    entity_id: light.outdoor_lights
  - service: light.turn_off
    data: {}
    entity_id: light.living_room_lights
  mode: single
- id: '1589340777638'
  alias: Turn on lights when I arrive home
  description: ''
  trigger:
  - entity_id: person.waltteri_hooli
    event: enter
    platform: zone
    zone: zone.home
  condition: []
  action:
  - service: light.turn_on
    entity_id: light.hallway_lights
  mode: single
- id: '1591634250161'
  alias: Send notification when sauna is warm
  description: ''
  trigger:
  - entity_id: sensor.sauna_temperature
    from: '65'
    platform: state
    to: '90'
  condition: []
  action:
  - data: {}
    service: script.1591634868068
- id: '1608746603619'
  alias: Motion-activated Light
  description: ''
  use_blueprint:
    path: homeassistant/motion_light.yaml
    input:
      no_motion_wait: '120'
      motion_entity: binary_sensor.bathroom_motion_sensor_occupancy
      light_target:
        device_id: a57b9d59b49d31fdae55d5248d341a91
- id: '1609295260367'
  alias: Hallway switch lights on toggle
  description: ''
  trigger:
  - device_id: 5b8d5022d0798d13d38b56abe32c4fd1
    discovery_id: 0x0017880104af2433 action_arrow_left_click
    domain: mqtt
    platform: device
    subtype: on-press
    type: action
  condition: []
  action:
  - type: turn_on
    device_id: d1561519bf1d2aeca0f9aacfc64a26af
    entity_id: light.front_door_light_1
    domain: light
    brightness_pct: 100
  mode: single
- id: '1609299547680'
  alias: Reset front door lock on open
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: dc5181e727d734b9355ce813aff9632c
    entity_id: binary_sensor.front_door_sensor_contact
    domain: binary_sensor
  condition:
  - condition: device
    device_id: ef0d4f4cb62091261d248f8e4f1c4e7a
    domain: lock
    entity_id: lock.front_door_lock_lock
    type: is_locked
  action:
  - device_id: ef0d4f4cb62091261d248f8e4f1c4e7a
    domain: lock
    entity_id: lock.front_door_lock_lock
    type: unlock
  - device_id: ef0d4f4cb62091261d248f8e4f1c4e7a
    domain: lock
    entity_id: lock.front_door_lock_lock
    type: lock
  mode: single
- id: '1611234355831'
  alias: Enable sleep timer
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.sleep_timer_toggle
    to: 'on'
  condition: []
  action:
  - service: timer.start
    data_template:
      duration: '{% set minutes = states(''input_number.sleep_timer_minutes'') | int
        %} {% set hours = states(''input_number.sleep_timer_hours'') | int %} {{ ''%02i''
        | format(hours) }}:{{ ''%02i'' | format(minutes) }}:00

        '
    entity_id: timer.sleep_timer
  mode: single
- id: '1611235661558'
  alias: Turn off monitor & chromecast after sleep timer
  description: ''
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.sleep_timer
  condition: []
  action:
  - service: media_player.turn_off
    data: {}
    entity_id: media_player.bedroom_tv
  - type: turn_off
    device_id: 3c49ed5873427de92ae40fb03156e491
    entity_id: switch.second_monitor
    domain: switch
  - service: input_boolean.turn_off
    data: {}
    entity_id: input_boolean.sleep_timer_toggle
  mode: single
- id: '1611237347841'
  alias: Cancel sleep timer
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.sleep_timer_toggle
    to: 'off'
  condition: []
  action:
  - service: timer.cancel
    data: {}
    entity_id: timer.sleep_timer
  mode: single
- id: '1611254605078'
  alias: Bedroom scenes input select next
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: b98fc56f327edc16772f2ab86ac7ce20
    type: action
    subtype: on_press
    discovery_id: 0x0017880104e45156 action_on_press
  - platform: device
    domain: mqtt
    device_id: 3559ef1e819e4be08e85d99c01bd1879
    type: action
    subtype: arrow_right_click
    discovery_id: 0x000d6ffffe49ceb2 action_arrow_right_click
  condition:
  - condition: state
    entity_id: group.bedroom_lights
    state: 'on'
  action:
  - service: input_select.select_next
    data: {}
    entity_id: input_select.bedroom_scenes
  mode: restart
- id: '1611255960569'
  alias: Bedroom scenes change by input select
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.bedroom_scenes
  condition: []
  action:
  - service: scene.turn_on
    data_template:
      entity_id: '{% set scene = states(''input_select.bedroom_scenes'') | replace(''
        '', ''_'') %} scene.bedroom_{{ ''%s'' | format(scene) }}

        '
      transition: 0.5
  - delay:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 500
  mode: queued
  max: 2
- id: '1611256666651'
  alias: Bedroom scenes input select previous
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 3559ef1e819e4be08e85d99c01bd1879
    type: action
    subtype: arrow_left_click
    discovery_id: 0x000d6ffffe49ceb2 action_arrow_left_click
  condition:
  - condition: state
    entity_id: group.bedroom_lights
    state: 'on'
  action:
  - service: input_select.select_previous
    data: {}
    entity_id: input_select.bedroom_scenes
  mode: restart
- id: '1611264191647'
  alias: Set kitchen motion sensor occupancy timeout
  description: ''
  trigger:
  - platform: mqtt
    topic: zigbee2mqtt/bridge/event
    payload: '{"type":"device_announce","data":{"friendly_name":"Kitchen motion sensor","ieee_address":"0x0017880104b6d671"}}'
  condition: []
  action:
  - service: mqtt.publish
    data:
      topic: zigbee2mqtt/Kitchen motion sensor/set
      payload: '{"occupancy_timeout": 60}'
  mode: single
- id: '1611271157717'
  alias: Bedroom wakeup routine
  description: Set lights bright at selected fade in minutes & time
  trigger:
  - platform: template
    value_template: '{{ (as_timestamp(now()) | int | timestamp_custom("%H:%M")) ==  (states.input_datetime.wakeup_routine_begin.attributes.timestamp
      - (states.input_number.wakeup_routine_fade_in_minutes.state | int * 60))  |
      timestamp_custom("%H:%M", false) }}

      '
  condition:
  - condition: state
    entity_id: input_boolean.wakeup_routine_enable
    state: 'on'
  action:
  - service: scene.turn_on
    data_template:
      transition: '{{states.input_number.wakeup_routine_fade_in_minutes.state | int
        * 60 }}'
    entity_id: scene.bedroom_cold
  mode: single
- id: '1611324203822'
  alias: Kitchen scenes change by input select
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.kitchen_scenes
  condition: []
  action:
  - service: scene.turn_on
    data_template:
      entity_id: '{% set scene = states(''input_select.kitchen_scenes'') %} scene.kitchen_{{
        ''%s'' | format(scene) }}

        '
      transition: 0.6
  mode: single
  max: 5
- id: '1611449206813'
  alias: Kitchen scenes next
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: f10b944916f5172aac20fecb63ca2a94
    type: action
    subtype: arrow_right_click
    discovery_id: 0x000d6ffffe18dfb6 action_arrow_right_click
  condition:
  - condition: state
    entity_id: group.kitchen_lights
    state: 'on'
  action:
  - service: input_select.select_next
    data: {}
    entity_id: input_select.kitchen_scenes
  mode: single
  max: 2
- id: '1611449260392'
  alias: Kitchen scenes previous
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: f10b944916f5172aac20fecb63ca2a94
    type: action
    subtype: arrow_left_click
    discovery_id: 0x000d6ffffe18dfb6 action_arrow_left_click
  condition:
  - condition: state
    entity_id: group.kitchen_lights
    state: 'on'
  action:
  - service: input_select.select_previous
    data: {}
    entity_id: input_select.kitchen_scenes
  mode: single
  max: 2
- id: '1611589722573'
  alias: Kitchen motion sensor change sensitivity when off
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.enable_kitchen_motion_sensor
  condition: []
  action:
  - service: script.1611609846357
    data_template:
      timeout: '{% if is_state(''input_boolean.enable_kitchen_motion_sensor'', ''on'')
        %}{{states(''input_number.kitchen_motion_lights_turn_off_after'')}}{% else
        %}600{% endif %}'
      motion_sensitivity: '{% if is_state(''input_boolean.enable_kitchen_motion_sensor'',
        ''on'') %}{{states(''input_select.kitchen_motion_sensor_motion_sensitivity'')}}{%
        else %}low{% endif %}'
  mode: single
- id: '1611597673022'
  alias: Kitchen motion activated lights
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 1e261401f1cad5e439ffa0caf46d349b
    entity_id: binary_sensor.kitchen_motion_sensor_occupancy
    domain: binary_sensor
  condition: []
  action:
  - service: light.turn_on
    data:
      transition: 1
    entity_id: light.kitchen_lights
  mode: single
- id: '1611597781838'
  alias: Kitchen motion detect stopped
  description: ''
  trigger:
  - type: no_motion
    platform: device
    device_id: 1e261401f1cad5e439ffa0caf46d349b
    entity_id: binary_sensor.kitchen_motion_sensor_occupancy
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 5
  condition: []
  action:
  - service: light.turn_off
    data_template:
      transition: '{{ states(''input_number.kitchen_motion_lights_fadeout'') | int
        }}'
    entity_id: light.kitchen_lights
  mode: restart
- id: '1611611449926'
  alias: Kitchen motion sensor change occupancy timeout by slider
  description: ''
  trigger:
  - platform: state
    entity_id: input_number.kitchen_motion_lights_turn_off_after
  condition: []
  action:
  - service: script.1611609846357
    data_template:
      timeout: '{{ trigger.to_state.state | int }}'
  mode: single
- id: '1611611914992'
  alias: Kitchen motion sensor change motion sensitivity by dropdown
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.kitchen_motion_sensor_motion_sensitivity
  condition: []
  action:
  - service: script.1611609846357
    data_template:
      motion_sensitivity: '{{ trigger.to_state.state }}'
  mode: single
- id: '1611796423802'
  alias: Living room change by input select
  description: ''
  trigger:
  - platform: state
    entity_id: input_select.living_room_scenes
  condition: []
  action:
  - service: scene.turn_on
    data_template:
      entity_id: '{% set scene = states(''input_select.living_room_scenes'') | replace(''
        '', ''_'') %} scene.living_room_{{ ''%s'' | format(scene) }}

        '
      transition: 0.5
  mode: single
- id: '1611796610275'
  alias: Living room turn off lights
  description: Fallback functionality for background lights etc
  trigger:
  - platform: device
    domain: mqtt
    device_id: 925435617af3c6d64716880bcd818d2a
    type: action
    subtype: off_press
    discovery_id: 0x0017880104e451b8 action_off_press
  condition: []
  action:
  - service: light.turn_off
    data:
      transition: 1
    entity_id: light.living_room_lights
  mode: single
- id: '1611799326957'
  alias: Intruder alert
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: dc5181e727d734b9355ce813aff9632c
    entity_id: binary_sensor.front_door_sensor_contact
    domain: binary_sensor
  - type: opened
    platform: device
    device_id: 364cf625fc145359b98cf5bb0ce39cd6
    entity_id: binary_sensor.hallway_door_sensor_contact
    domain: binary_sensor
  condition:
  - condition: not
    conditions:
    - condition: zone
      entity_id: device_tracker.sm_g970f
      zone: zone.home
  action:
  - service: notify.notify
    data:
      title: Alert
      message: Front door has been opened
  - service: notify.persistent_notification
    data:
      title: Alert
      message: Front door has been opened when you were away
  mode: single
- id: '1612088980623'
  alias: Living room scenes input select next
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 925435617af3c6d64716880bcd818d2a
    type: action
    subtype: on_press
    discovery_id: 0x0017880104e451b8 action_on_press
  condition:
  - condition: state
    entity_id: group.living_room_roof_lights
    state: 'on'
  action:
  - service: input_select.select_next
    data: {}
    entity_id: input_select.living_room_scenes
  mode: single
- id: '1614550296147'
  alias: Aqara Magic Cube (Z2M)
  description: ''
  use_blueprint:
    path: luckypoppy/z2m-xiaomi-cube-controller.yaml
    input:
      remote: sensor.bedroom_magic_cube_action_2
      slide_face_0: []
      rotate_cw_face_0:
      - condition: state
        entity_id: light.bedroom_lights
        state: 'on'
      - service: light.turn_on
        entity_id: light.bedroom_lights
        data_template:
          transition: 0.5
          brightness_step_pct: '{{states.sensor.bedroom_magic_cube_action_2.attributes.angle
            / 1.8 }}'
      rotate_ccw_face_0:
      - condition: state
        entity_id: light.bedroom_lights
        state: 'on'
      - service: light.turn_on
        entity_id: light.bedroom_lights
        data_template:
          transition: 0.5
          brightness_step_pct: '{{states.sensor.bedroom_magic_cube_action_2.attributes.angle
            / 1.8 }}'
      shake:
      - service: light.toggle
        data:
          transition: 1
        entity_id: light.bedroom_lights
