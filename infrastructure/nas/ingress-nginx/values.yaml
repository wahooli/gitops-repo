controller:
  replicaCount: 1
  allowSnippetAnnotations: true  # authentik forward auth
  terminationGracePeriodSeconds: 15
  config:
    use-forwarded-headers: true
    # forwarded-for-header: "CF-Connecting-IP"
    enable-real-ip: "true"
    proxy-real-ip-cidr: "${cluster_native_cidr},173.245.48.0/20,103.21.244.0/22,103.22.200.0/22,103.31.4.0/22,141.101.64.0/18,108.162.192.0/18,190.93.240.0/20,188.114.96.0/20,197.234.240.0/22,198.41.128.0/17,162.158.0.0/15,104.16.0.0/13,104.24.0.0/14,172.64.0.0/13,131.0.72.0/22,2400:cb00::/32,2606:4700::/32,2803:f800::/32,2405:b500::/32,2405:8100::/32,2a06:98c0::/29,2c0f:f248::/32"
    log-format-escape-json: "true"
    # log-format-upstream: '{"timestamp": "$time_iso8601", "requestID": "$req_id", "proxyUpstreamName": "$proxy_upstream_name", "proxyAlternativeUpstreamName": "$proxy_alternative_upstream_name","upstreamStatus": "$upstream_status", "upstreamAddr": "$upstream_addr","httpRequest":{"requestMethod": "$request_method", "requestUrl": "$host$request_uri", "status": $status,"requestSize": "$request_length", "responseSize": "$upstream_response_length", "userAgent": "$http_user_agent", "remoteIp": "$remote_addr", "referer": "$http_referer", "latency": "$upstream_response_time s", "protocol":"$server_protocol"}}'
    log-format-upstream: '{"timestamp": "$time_iso8601", "remote_addr": "$proxy_protocol_addr", "x_forwarded_for": "$proxy_add_x_forwarded_for", "request_id": "$req_id", "remote_user": "$remote_user", "bytes_sent": $bytes_sent, "request_time": $request_time, "status": $status, "vhost": "$host", "request_proto": "$server_protocol", "path": "$uri", "request_query": "$args", "request_length": $request_length, "duration": $request_time,"method": "$request_method", "http_referrer": "$http_referer", "http_user_agent": "$http_user_agent"}'
  metrics:
    enabled: true
  service:
    externalTrafficPolicy: Local
    # loadBalancerClass: io.cilium/bgp-control-plane
    # loadBalancerClass: kube-vip.io/kube-vip-class
    type: LoadBalancer
    annotations:
      external-dns.alpha.kubernetes.io/hostname: nginx.nas.absolutist.it,nginx.nas.wahoo.li
      lbipam.cilium.io/ips: ${nginx_lb_ip}
